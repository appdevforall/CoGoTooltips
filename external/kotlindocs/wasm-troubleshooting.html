<html>
 <head>
  <meta charset="utf-8"/>
  <link href="doc_style.css" rel="stylesheet"/>
 </head>
 <body>
  <a class="menu-link" href="toc.html">
   MENU
  </a>
  <hr/>
  <div class="article-content">
   <h1 data-toc="wasm-troubleshooting" id="wasm-troubleshooting.md">
    Troubleshooting
   </h1>
   <aside class="prompt" data-title="" data-type="note" id="-vz4fqo_2">
    <p id="-vz4fqo_9">
     Kotlin/Wasm is
     <a data-tooltip="The Kotlin language and toolset are divided into many components such as the compilers for the JVM, JS and Native targets, the Standard Library, various accompanying tools and so on. Many of these components were officially released as Stable, which means that they were evolved in aâ€¦" href="components-stability.html" id="-vz4fqo_10">
      Alpha
     </a>
     . It may be changed at any time. Use it in scenarios before production. We would appreciate your feedback in
     <a data-external="true" href="https://youtrack.jetbrains.com/issue/KT-56492" id="-vz4fqo_11" rel="noopener noreferrer">
      YouTrack
     </a>
     .
    </p>
   </aside>
   <p id="-vz4fqo_3">
    Kotlin/Wasm relies on new
    <a data-external="true" href="https://webassembly.org/roadmap/" id="-vz4fqo_12" rel="noopener noreferrer">
     WebAssembly proposals
    </a>
    like
    <a data-tooltip="Since Kotlin 1.9.20, the Kotlin toolchain uses the latest version of the Wasm garbage collection (WasmGC) proposal." href="#garbage-collection-proposal" id="-vz4fqo_13">
     garbage collection
    </a>
    and
    <a data-tooltip="Since Kotlin 2.0.0, we have introduced support for the new version of Wasm exception handling proposal within Kotlin/Wasm." href="#exception-handling-proposal" id="-vz4fqo_14">
     exception handling
    </a>
    to introduce improvements and new features within WebAssembly.
   </p>
   <p id="-vz4fqo_4">
    However, to ensure these features work properly, you need an environment that supports the new proposals. In some cases, you may need to set up the environment to make it compatible with the proposals.
   </p>
   <section class="chapter">
    <h2 data-toc="browser-versions" id="browser-versions">
     Browser versions
    </h2>
    <p id="-vz4fqo_15">
     To run applications built with Kotlin/Wasm in a browser, you need a browser version supporting the new
     <a data-external="true" href="https://github.com/WebAssembly/gc" id="-vz4fqo_20" rel="noopener noreferrer">
      WebAssembly garbage collection (WasmGC) feature
     </a>
     . Check if the browser version supports the new WasmGC by default or if you need to make changes to the environment.
    </p>
    <section class="chapter">
     <h3 data-toc="chrome" id="chrome">
      Chrome
     </h3>
     <ul class="list _bullet" id="-vz4fqo_21">
      <li class="list__item" id="-vz4fqo_22">
       <p id="-vz4fqo_24">
        <span class="control" id="-vz4fqo_26">
         For version 119 or later:
        </span>
       </p>
       <p id="-vz4fqo_25">
        Works by default.
       </p>
      </li>
      <li class="list__item" id="-vz4fqo_23">
       <p id="-vz4fqo_27">
        <span class="control" id="-vz4fqo_30">
         For older versions:
        </span>
       </p>
       <aside class="prompt" data-title="" data-type="note" id="-vz4fqo_28">
        <p id="-vz4fqo_31">
         To run applications in an older browser, you need a Kotlin version older than 1.9.20.
        </p>
       </aside>
       <ol class="list _decimal" id="-vz4fqo_29" type="1">
        <li class="list__item" id="-vz4fqo_32">
         <p>
          In your browser, go to
          <code class="code" id="-vz4fqo_35">
           chrome://flags/#enable-webassembly-garbage-collection
          </code>
          .
         </p>
        </li>
        <li class="list__item" id="-vz4fqo_33">
         <p>
          Enable
          <span class="control" id="-vz4fqo_36">
           WebAssembly Garbage Collection
          </span>
          .
         </p>
        </li>
        <li class="list__item" id="-vz4fqo_34">
         <p>
          Relaunch your browser.
         </p>
        </li>
       </ol>
      </li>
     </ul>
    </section>
    <section class="chapter">
     <h3 data-toc="chromium-based" id="chromium-based">
      Chromium-based
     </h3>
     <p id="-vz4fqo_37">
      Including Chromium-based browsers such as Edge, Brave, Opera, or Samsung Internet.
     </p>
     <ul class="list _bullet" id="-vz4fqo_38">
      <li class="list__item" id="-vz4fqo_39">
       <p id="-vz4fqo_41">
        <span class="control" id="-vz4fqo_43">
         For version 119 or later:
        </span>
       </p>
       <p id="-vz4fqo_42">
        Works by default.
       </p>
      </li>
      <li class="list__item" id="-vz4fqo_40">
       <p id="-vz4fqo_44">
        <span class="control" id="-vz4fqo_47">
         For older versions:
        </span>
       </p>
       <aside class="prompt" data-title="" data-type="note" id="-vz4fqo_45">
        <p id="-vz4fqo_48">
         To run applications in an older browser, you need a Kotlin version older than 1.9.20.
        </p>
       </aside>
       <p id="-vz4fqo_46">
        Run the application with the
        <code class="code" id="-vz4fqo_49">
         --js-flags=--experimental-wasm-gc
        </code>
        command line argument.
       </p>
      </li>
     </ul>
    </section>
    <section class="chapter">
     <h3 data-toc="firefox" id="firefox">
      Firefox
     </h3>
     <ul class="list _bullet" id="-vz4fqo_50">
      <li class="list__item" id="-vz4fqo_51">
       <p id="-vz4fqo_53">
        <span class="control" id="-vz4fqo_55">
         For version 120 or later:
        </span>
       </p>
       <p id="-vz4fqo_54">
        Works by default.
       </p>
      </li>
      <li class="list__item" id="-vz4fqo_52">
       <p id="-vz4fqo_56">
        <span class="control" id="-vz4fqo_58">
         For version 119:
        </span>
       </p>
       <ol class="list _decimal" id="-vz4fqo_57" type="1">
        <li class="list__item" id="-vz4fqo_59">
         <p>
          In your browser, go to
          <code class="code" id="-vz4fqo_62">
           about:config
          </code>
          .
         </p>
        </li>
        <li class="list__item" id="-vz4fqo_60">
         <p>
          Enable
          <code class="code" id="-vz4fqo_63">
           javascript.options.wasm_gc
          </code>
          option.
         </p>
        </li>
        <li class="list__item" id="-vz4fqo_61">
         <p>
          Refresh the page.
         </p>
        </li>
       </ol>
      </li>
     </ul>
    </section>
    <section class="chapter">
     <h3 data-toc="safari-webkit" id="safari-webkit">
      Safari/WebKit
     </h3>
     <ul class="list _bullet" id="-vz4fqo_64">
      <li class="list__item" id="-vz4fqo_66">
       <p id="-vz4fqo_68">
        <span class="control" id="-vz4fqo_70">
         For version 18.2 or later:
        </span>
       </p>
       <p id="-vz4fqo_69">
        Works by default.
       </p>
      </li>
      <li class="list__item" id="-vz4fqo_67">
       <p id="-vz4fqo_71">
        <span class="control" id="-vz4fqo_73">
         For older versions:
        </span>
       </p>
       <p id="-vz4fqo_72">
        Not supported.
       </p>
      </li>
     </ul>
     <aside class="prompt" data-title="" data-type="note" id="-vz4fqo_65">
      <p id="-vz4fqo_74">
       Safari 18.2 is available for iOS 18.2, iPadOS 18.2, visionOS 2.2, macOS 15.2, macOS Sonoma, and macOS Ventura. On iOS and iPadOS, Safari 18.2 is bundled with the operating system. To get it, update your device to version 18.2 or later.
      </p>
      <p id="-vz4fqo_75">
       For more information, see the
       <a data-external="true" href="https://developer.apple.com/documentation/safari-release-notes/safari-18_2-release-notes#Overview" id="-vz4fqo_76" rel="noopener noreferrer">
        Safari release notes
       </a>
       .
      </p>
     </aside>
    </section>
   </section>
   <section class="chapter">
    <h2 data-toc="wasm-proposals-support" id="wasm-proposals-support">
     Wasm proposals support
    </h2>
    <p id="-vz4fqo_77">
     Kotlin/Wasm improvements are based on
     <a data-external="true" href="https://webassembly.org/roadmap/" id="-vz4fqo_80" rel="noopener noreferrer">
      WebAssembly proposals
     </a>
     . Here you can find details about the support for WebAssembly's garbage collection and exception handling proposals.
    </p>
    <section class="chapter">
     <h3 data-toc="garbage-collection-proposal" id="garbage-collection-proposal">
      Garbage collection proposal
     </h3>
     <p id="-vz4fqo_81">
      Since Kotlin 1.9.20, the Kotlin toolchain uses the latest version of the
      <a data-external="true" href="https://github.com/WebAssembly/gc" id="-vz4fqo_83" rel="noopener noreferrer">
       Wasm garbage collection
      </a>
      (WasmGC) proposal.
     </p>
     <p id="-vz4fqo_82">
      For this reason, we strongly recommend that you update your Wasm projects to the latest version of Kotlin. We also recommend you use the latest versions of browsers with the Wasm environment.
     </p>
    </section>
    <section class="chapter">
     <h3 data-toc="exception-handling-proposal" id="exception-handling-proposal">
      Exception handling proposal
     </h3>
     <p id="-vz4fqo_84">
      Since Kotlin 2.0.0, we have introduced support for the new version of Wasm
      <a data-external="true" href="https://github.com/WebAssembly/exception-handling/blob/main/proposals/exception-handling/Exceptions.md" id="-vz4fqo_89" rel="noopener noreferrer">
       exception handling proposal
      </a>
      within Kotlin/Wasm.
     </p>
     <p id="-vz4fqo_85">
      This update ensures the new exception handling proposal aligns with Kotlin requirements, enabling the use of Kotlin/Wasm on virtual machines that only support the latest version of the proposal.
     </p>
     <p id="-vz4fqo_86">
      The new exception handling proposal is activated using the
      <code class="code" id="-vz4fqo_90">
       -Xwasm-use-new-exception-proposal
      </code>
      compiler option. It is turned off by default.
     </p>
     <p id="-vz4fqo_87">
     </p>
     <aside class="prompt" data-title="" data-type="tip" id="-vz4fqo_88">
      <p id="-vz4fqo_91">
       Learn more about setting up projects, using dependencies, and other tasks with our
       <a data-external="true" href="https://github.com/Kotlin/kotlin-wasm-examples#readme" id="-vz4fqo_92" rel="noopener noreferrer">
        Kotlin/Wasm examples
       </a>
       .
      </p>
     </aside>
    </section>
   </section>
   <section class="chapter">
    <h2 data-toc="use-default-import" id="use-default-import">
     Use default import
    </h2>
    <p id="-vz4fqo_93">
     <a data-tooltip="Kotlin/Wasm allows you to use both JavaScript code in Kotlin and Kotlin code in JavaScript." href="wasm-js-interop.html" id="-vz4fqo_98">
      Importing Kotlin/Wasm code into Javascript
     </a>
     has shifted to named exports, moving away from default exports.
    </p>
    <p id="-vz4fqo_94">
     If you still want to use a default import, generate a new JavaScript wrapper module. Create a
     <code class="code" id="-vz4fqo_99">
      .mjs
     </code>
     file with the following snippet:
    </p>
    <div class="code-block" data-lang="javascript">
     // Specifies the path to the main .mjs file
import * as moduleExports from "./wasm-test.mjs";

export { moduleExports as default };
    </div>
    <p id="-vz4fqo_96">
     You can place your new
     <code class="code" id="-vz4fqo_100">
      .mjs
     </code>
     file in the resources folder, and it will automatically be placed next to the main
     <code class="code" id="-vz4fqo_101">
      .mjs
     </code>
     file during the build process.
    </p>
    <p id="-vz4fqo_97">
     You can also place your
     <code class="code" id="-vz4fqo_102">
      .mjs
     </code>
     file in a custom location. In this case, you need to either manually move it next to the main
     <code class="code" id="-vz4fqo_103">
      .mjs
     </code>
     file or adjust the path in the import statement to match its location.
    </p>
   </section>
   <section class="chapter">
    <h2 data-toc="slow-kotlin-wasm-compilation" id="slow-kotlin-wasm-compilation">
     Slow Kotlin/Wasm compilation
    </h2>
    <p id="-vz4fqo_104">
     When working on Kotlin/Wasm projects, you may experience slow compilation times. This happens because the Kotlin/Wasm toolchain recompiles the entire codebase every time you make a change.
    </p>
    <p id="-vz4fqo_105">
     To mitigate this issue, Kotlin/Wasm targets support incremental compilation, which enables the compiler to recompile only those files relevant to changes from the last compilation.
    </p>
    <p id="-vz4fqo_106">
     Using incremental compilation reduces the compilation time. It doubles the development speed for now, with plans to improve it further in future releases.
    </p>
    <p id="-vz4fqo_107">
     In the current setup, incremental compilation for the Wasm targets is disabled by default. To enable it, add the following line to your project's
     <code class="code" id="-vz4fqo_110">
      local.properties
     </code>
     or
     <code class="code" id="-vz4fqo_111">
      gradle.properties
     </code>
     file:
    </p>
    <div class="code-block" data-lang="none">
     kotlin.incremental.wasm=true
    </div>
    <aside class="prompt" data-title="" data-type="note" id="-vz4fqo_109">
     <p id="-vz4fqo_112">
      Try out the Kotlin/Wasm incremental compilation and
      <a data-external="true" href="https://youtrack.jetbrains.com/issue/KT-72158/Kotlin-Wasm-incremental-compilation-feedback" id="-vz4fqo_113" rel="noopener noreferrer">
       share your feedback
      </a>
      . Your insights help make the feature stable and enabled by default sooner.
     </p>
    </aside>
   </section>
   <div class="last-modified">
    Last modified: 16 December 2024
   </div>
   <div data-feedback-placeholder="true">
   </div>
  </div>
 </body>
</html>
